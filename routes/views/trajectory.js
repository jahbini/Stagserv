// Generated by CoffeeScript 1.9.3
(function() {
  var Trajectory, base, keystone, winston;

  keystone = require('keystone');

  Trajectory = keystone.list('Trajectory');

  winston = require('winston');

  require('winston-loggly');

  winston.add(winston.transports.Loggly, {
    token: "9f7aaef2-588b-46e9-ab0e-7b1dabc9da01",
    subdomain: "bamboocando",
    tags: ["Winston-NodeJS"],
    json: true
  });

  winston.log('info', "Retrotope Server Started");

  if (typeof window !== "undefined" && window !== null) {
    base = window;
  }

  if ((typeof module !== "undefined" && module !== null ? module.exports : void 0) != null) {
    base = module;
  }

  base.exports = function(req, res) {
    var loggingData, t, view;
    view = new keystone.View(req, res);
    t = new Trajectory.model(req.body);
    loggingData = new Trajectory.model(req.body);
    loggingData.readings;
    t.readings = JSON.stringify(req.body.readings);
    t.save(function(err) {
      if (err) {
        console.error(err);
        res.status(500).send({
          error: err
        });
      } else {
        console.log('Data Trajectory added ' + ' to the database.');
        t.readings = "http://sensor.retrotope.com/trajectory/" + t.id;
        winston.log('info', t);
        res.status(200).send({
          message: "OK"
        });
      }
    });
  };

}).call(this);
